pwd_policy() {
    log "${BLUE}Configuring password policy${NC}"

    # Backup the config file
    log "${BLUE}Creating a backup of /etc/pam.d/common-password${NC}"
    cp /etc/pam.d/common-password /etc/pam.d/common-password.bak >> "$LOG_FILE" 2>&1

    if [ $? -ne 0 ]; then
        log "${BLUE}Failed to create a backup: ${RED}FAILED ${NC}"
        echo -e "${BLUE}Failed to create a backup: ${RED}FAILED ${NC}" >> report.txt
    else
        log "${GREEN}Successfully created a backup: DONE${NC}"
        echo -e "${BLUE}Successfully created a backup: ${GREEN}DONE ${NC}" >> report.txt
    fi

    # Set minimum length and password complexity requirements
log "${BLUE}Setting password requirements in PAM${NC}"

if sed -i '/^password.*requisite/ s/pam_unix.so/pam_unix.so retry=3 minlen=8 ucredit=-1 lcredit=-1 dcredit=-1 ocredit=-1 remember=4/' /etc/pam.d/common-password >> "$LOG_FILE" 2>&1; then
    log "${BLUE}Successfully updated /etc/pam.d/common-password: ${GREEN}DONE${NC}"
    echo -e "${BLUE}Successfully updated /etc/pam.d/common-password: ${GREEN}DONE${NC}" >> report.txt
else
    log "${BLUE}Failed to edit /etc/pam.d/common-password: ${RED}FAILED ${NC}"
    echo -e "${BLUE}Failed to edit /etc/pam.d/common-password: ${RED}FAILED ${NC}" >> report.txt
fi

    # Set password expiry to 180 days and warning period to 14 days
    log "${BLUE}Setting password expiry and warning period${NC}"
    sed -i '/^PASS_MAX_DAYS/ s/^.*$/PASS_MAX_DAYS   180/' /etc/login.defs >> "$LOG_FILE" 2>&1
    sed -i '/^PASS_WARN_AGE/ s/^.*$/PASS_WARN_AGE   15/' /etc/login.defs >> "$LOG_FILE" 2>&1

    if [ $? -ne 0 ]; then
    log "${BLUE}Failed to edit /etc/login.defs: ${RED}FAILED ${NC}" 
    echo -e "${BLUE}Failed to edit /etc/login.defs: ${RED}FAILED ${NC}" >> report.txt
else
    log "${BLUE}Successfully updated /etc/login.defs: ${GREEN}DONE ${NC}" 
    echo -e "${BLUE}Successfully updated /etc/login.defs: ${GREEN}DONE ${NC}" >> report.txt
fi
echo -e "${BLUE}Successfully configured Password Policy: ${GREEN}DONE ${NC}" >> report.txt
}